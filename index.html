<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>今日到校通知</title>
<style>
  body { font-family: Arial, sans-serif; background:#f0f8ff; padding:30px; }
  h2 { color:#333; text-align:center; }
  #notice { 
    margin-top:20px; 
    padding:10px; 
    background:#ffffff; 
    border:2px solid #87cefa; 
    border-radius:10px; 
    max-width:600px; 
    margin-left:auto; margin-right:auto;
  }
  .student {
    padding:5px; 
    border-bottom:1px solid #eee;
    font-size:1.2em;
  }
</style>
</head>
<body>
<h2>今日到校通知</h2>
<div id="notice">載入中…</div>

<script>
const channelURL = "https://thingspeak.mathworks.com/channels/3062393/feeds.json?results=1000";

fetch(channelURL)
  .then(response => response.json())
  .then(data => {
    const feeds = data.feeds;

    // 取得今天日期字串 YYYY-MM-DD
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const todayStr = `${yyyy}-${mm}-${dd}`;

    // 過濾出今天的資料（假設 field1 是學生姓名或編號）
    const todayFeeds = feeds.filter(f => f.created_at.startsWith(todayStr));

    const noticeDiv = document.getElementById('notice');
    if(todayFeeds.length === 0){
      noticeDiv.innerHTML = "<p>今天還沒學生到校</p>";
    } else {
      noticeDiv.innerHTML = todayFeeds.map(f => `<div class="student">學生到校：${f.field1} (${f.created_at.substring(11,19)})</div>`).join('');
    }
  })
  .catch(err => {
    document.getElementById('notice').innerHTML = "取得資料錯誤";
    console.error(err);
  });
</script>
</body>
</html>
